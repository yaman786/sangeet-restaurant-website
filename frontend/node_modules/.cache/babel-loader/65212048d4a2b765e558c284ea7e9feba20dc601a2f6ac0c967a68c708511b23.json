{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Navigate,useLocation}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children,requiredRole=null}=_ref;const[isAuthenticated,setIsAuthenticated]=useState(false);const[isLoading,setIsLoading]=useState(true);const[userRole,setUserRole]=useState(null);const location=useLocation();useEffect(()=>{const checkAuth=()=>{const adminToken=localStorage.getItem('adminToken');const kitchenToken=localStorage.getItem('kitchenToken');const adminUser=localStorage.getItem('adminUser');const kitchenUser=localStorage.getItem('kitchenUser');let authenticated=false;let role=null;// Check admin authentication first (admin can access everything)\nif(adminToken&&adminUser){try{JSON.parse(adminUser);// Validate JSON format\nauthenticated=true;role='admin';}catch(error){console.error('Error parsing admin user data:',error);}}// Check kitchen authentication\nelse if(kitchenToken&&kitchenUser){try{JSON.parse(kitchenUser);// Validate JSON format\nauthenticated=true;role='kitchen';}catch(error){console.error('Error parsing kitchen user data:',error);}}setIsAuthenticated(authenticated);setUserRole(role);setIsLoading(false);};checkAuth();},[]);if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-sangeet-neutral-950 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-sangeet-400\"})});}if(!isAuthenticated){// Redirect to appropriate login page based on the route\nconst isKitchenRoute=location.pathname.startsWith('/kitchen');const isAdminRoute=location.pathname.startsWith('/admin');if(isKitchenRoute){return/*#__PURE__*/_jsx(Navigate,{to:\"/kitchen/login\",replace:true});}else if(isAdminRoute){return/*#__PURE__*/_jsx(Navigate,{to:\"/admin/login\",replace:true});}else{return/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true});}}// Check role-specific access\nif(requiredRole&&userRole!==requiredRole&&userRole!=='admin'){// Admin can access everything, but other roles need specific permissions\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-sangeet-neutral-950 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-6xl mb-4\",children:\"\\uD83D\\uDEAB\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-sangeet-neutral-100 mb-2\",children:\"Access Denied\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sangeet-neutral-400 mb-4\",children:\"You don't have permission to access this page.\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-sangeet-neutral-500\",children:[\"Required role: \",requiredRole,\" | Your role: \",userRole]})]})});}return children;};export default ProtectedRoute;","map":{"version":3,"names":["React","useEffect","useState","Navigate","useLocation","jsx","_jsx","jsxs","_jsxs","ProtectedRoute","_ref","children","requiredRole","isAuthenticated","setIsAuthenticated","isLoading","setIsLoading","userRole","setUserRole","location","checkAuth","adminToken","localStorage","getItem","kitchenToken","adminUser","kitchenUser","authenticated","role","JSON","parse","error","console","className","isKitchenRoute","pathname","startsWith","isAdminRoute","to","replace"],"sources":["/Users/amanrana/Desktop/sangeet_restaurant_website/frontend/src/components/ProtectedRoute.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Navigate, useLocation } from 'react-router-dom';\n\nconst ProtectedRoute = ({ children, requiredRole = null }) => {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [userRole, setUserRole] = useState(null);\n  const location = useLocation();\n\n  useEffect(() => {\n    const checkAuth = () => {\n      const adminToken = localStorage.getItem('adminToken');\n      const kitchenToken = localStorage.getItem('kitchenToken');\n      const adminUser = localStorage.getItem('adminUser');\n      const kitchenUser = localStorage.getItem('kitchenUser');\n\n      let authenticated = false;\n      let role = null;\n\n      // Check admin authentication first (admin can access everything)\n      if (adminToken && adminUser) {\n        try {\n          JSON.parse(adminUser); // Validate JSON format\n          authenticated = true;\n          role = 'admin';\n        } catch (error) {\n          console.error('Error parsing admin user data:', error);\n        }\n      }\n      // Check kitchen authentication\n      else if (kitchenToken && kitchenUser) {\n        try {\n          JSON.parse(kitchenUser); // Validate JSON format\n          authenticated = true;\n          role = 'kitchen';\n        } catch (error) {\n          console.error('Error parsing kitchen user data:', error);\n        }\n      }\n\n      setIsAuthenticated(authenticated);\n      setUserRole(role);\n      setIsLoading(false);\n    };\n\n    checkAuth();\n  }, []);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-sangeet-neutral-950 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-sangeet-400\"></div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    // Redirect to appropriate login page based on the route\n    const isKitchenRoute = location.pathname.startsWith('/kitchen');\n    const isAdminRoute = location.pathname.startsWith('/admin');\n    \n    if (isKitchenRoute) {\n      return <Navigate to=\"/kitchen/login\" replace />;\n    } else if (isAdminRoute) {\n      return <Navigate to=\"/admin/login\" replace />;\n    } else {\n      return <Navigate to=\"/login\" replace />;\n    }\n  }\n\n  // Check role-specific access\n  if (requiredRole && userRole !== requiredRole && userRole !== 'admin') {\n    // Admin can access everything, but other roles need specific permissions\n    return (\n      <div className=\"min-h-screen bg-sangeet-neutral-950 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4\">ðŸš«</div>\n          <h1 className=\"text-2xl font-bold text-sangeet-neutral-100 mb-2\">Access Denied</h1>\n          <p className=\"text-sangeet-neutral-400 mb-4\">\n            You don't have permission to access this page.\n          </p>\n          <p className=\"text-sm text-sangeet-neutral-500\">\n            Required role: {requiredRole} | Your role: {userRole}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return children;\n};\n\nexport default ProtectedRoute;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,QAAQ,CAAEC,WAAW,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEzD,KAAM,CAAAC,cAAc,CAAGC,IAAA,EAAuC,IAAtC,CAAEC,QAAQ,CAAEC,YAAY,CAAG,IAAK,CAAC,CAAAF,IAAA,CACvD,KAAM,CAACG,eAAe,CAAEC,kBAAkB,CAAC,CAAGZ,QAAQ,CAAC,KAAK,CAAC,CAC7D,KAAM,CAACa,SAAS,CAAEC,YAAY,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAACe,QAAQ,CAAEC,WAAW,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAAAiB,QAAQ,CAAGf,WAAW,CAAC,CAAC,CAE9BH,SAAS,CAAC,IAAM,CACd,KAAM,CAAAmB,SAAS,CAAGA,CAAA,GAAM,CACtB,KAAM,CAAAC,UAAU,CAAGC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CACrD,KAAM,CAAAC,YAAY,CAAGF,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CACzD,KAAM,CAAAE,SAAS,CAAGH,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,CACnD,KAAM,CAAAG,WAAW,CAAGJ,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAEvD,GAAI,CAAAI,aAAa,CAAG,KAAK,CACzB,GAAI,CAAAC,IAAI,CAAG,IAAI,CAEf;AACA,GAAIP,UAAU,EAAII,SAAS,CAAE,CAC3B,GAAI,CACFI,IAAI,CAACC,KAAK,CAACL,SAAS,CAAC,CAAE;AACvBE,aAAa,CAAG,IAAI,CACpBC,IAAI,CAAG,OAAO,CAChB,CAAE,MAAOG,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,gCAAgC,CAAEA,KAAK,CAAC,CACxD,CACF,CACA;AAAA,IACK,IAAIP,YAAY,EAAIE,WAAW,CAAE,CACpC,GAAI,CACFG,IAAI,CAACC,KAAK,CAACJ,WAAW,CAAC,CAAE;AACzBC,aAAa,CAAG,IAAI,CACpBC,IAAI,CAAG,SAAS,CAClB,CAAE,MAAOG,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CAC1D,CACF,CAEAjB,kBAAkB,CAACa,aAAa,CAAC,CACjCT,WAAW,CAACU,IAAI,CAAC,CACjBZ,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,CAEDI,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,EAAE,CAAC,CAEN,GAAIL,SAAS,CAAE,CACb,mBACET,IAAA,QAAK2B,SAAS,CAAC,sEAAsE,CAAAtB,QAAA,cACnFL,IAAA,QAAK2B,SAAS,CAAC,mEAAmE,CAAM,CAAC,CACtF,CAAC,CAEV,CAEA,GAAI,CAACpB,eAAe,CAAE,CACpB;AACA,KAAM,CAAAqB,cAAc,CAAGf,QAAQ,CAACgB,QAAQ,CAACC,UAAU,CAAC,UAAU,CAAC,CAC/D,KAAM,CAAAC,YAAY,CAAGlB,QAAQ,CAACgB,QAAQ,CAACC,UAAU,CAAC,QAAQ,CAAC,CAE3D,GAAIF,cAAc,CAAE,CAClB,mBAAO5B,IAAA,CAACH,QAAQ,EAACmC,EAAE,CAAC,gBAAgB,CAACC,OAAO,MAAE,CAAC,CACjD,CAAC,IAAM,IAAIF,YAAY,CAAE,CACvB,mBAAO/B,IAAA,CAACH,QAAQ,EAACmC,EAAE,CAAC,cAAc,CAACC,OAAO,MAAE,CAAC,CAC/C,CAAC,IAAM,CACL,mBAAOjC,IAAA,CAACH,QAAQ,EAACmC,EAAE,CAAC,QAAQ,CAACC,OAAO,MAAE,CAAC,CACzC,CACF,CAEA;AACA,GAAI3B,YAAY,EAAIK,QAAQ,GAAKL,YAAY,EAAIK,QAAQ,GAAK,OAAO,CAAE,CACrE;AACA,mBACEX,IAAA,QAAK2B,SAAS,CAAC,sEAAsE,CAAAtB,QAAA,cACnFH,KAAA,QAAKyB,SAAS,CAAC,aAAa,CAAAtB,QAAA,eAC1BL,IAAA,QAAK2B,SAAS,CAAC,eAAe,CAAAtB,QAAA,CAAC,cAAE,CAAK,CAAC,cACvCL,IAAA,OAAI2B,SAAS,CAAC,kDAAkD,CAAAtB,QAAA,CAAC,eAAa,CAAI,CAAC,cACnFL,IAAA,MAAG2B,SAAS,CAAC,+BAA+B,CAAAtB,QAAA,CAAC,gDAE7C,CAAG,CAAC,cACJH,KAAA,MAAGyB,SAAS,CAAC,kCAAkC,CAAAtB,QAAA,EAAC,iBAC/B,CAACC,YAAY,CAAC,gBAAc,CAACK,QAAQ,EACnD,CAAC,EACD,CAAC,CACH,CAAC,CAEV,CAEA,MAAO,CAAAN,QAAQ,CACjB,CAAC,CAED,cAAe,CAAAF,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}